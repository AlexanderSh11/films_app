<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Главная страница</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}"/>
</head>
<body>
    <header>
        <h1>Cinema</h1>
        <nav>
            <ul>
                <li><a href="{% url 'home' %}">Главная</a></li>
                <li><a href="{% url 'search' %}">Поиск</a></li>
                {% if user.is_authenticated %}
                    <li><a href="{% url 'favorites' user.id%}">Избранное</a></li>
                    <li><a href="{% url 'profile' user.id%}">Профиль: {{ user.username }}</a></li>
                    <li>
                        <form id="logout-form" method="post" action="{% url 'logout' %}" style="display: none;">
                            {% csrf_token %}
                        </form>
                        <a href="#" onclick="document.getElementById('logout-form').submit()">Выход из аккаунта</a>
                    </li>
                {% else %}
                    <li><a href="{% url 'login' %}">Авторизация</a></li>
                    <li><a href="{% url 'signup' %}">Регистрация</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>
    <main>
        <h2>Фильмы</h2>
        {% if show_recommendations %}
            <h2 class="recommendations-title">Топ-10 фильмов для Вас</h2>
            <div class="movie-scroll-container">
                <div class="movie-row">
                    {% for movie in recommendations %}
                    <div class="movie-card">
                        <img src="{{ movie.poster_link }}" alt="{{ movie.movie_name }}" width="24" height="18" class="movie-poster">
                        <h4>{{ movie.movie_name }}</h4>
                        <p>Год: {{ movie.year }}</p>
                        <p class="long2">Режиссер: {{ movie.director }}</p>
                        <p>Рейтинг: {{ movie.rating }}</p>
                        <p class="long3">Жанр: {{ movie.genre }}</p>
                        <div class="rating-div">
                            {% if movie.id in user_favorites %}
                                <a href="{% url 'remove_from_favorites' movie.id %}" class="btn" style="background: #f44336;">Удалить</a>
                            {% else %}
                                <a href="{% url 'add_to_favorites' movie.id %}" class="btn" style="background: #4caf50;">В избранное</a>
                            {% endif %}
                            <a href="{% url 'movie_detail' movie.id %}" class="btn" style="background: #0000ff;">Подробнее</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        {% for genre, movies in movies_by_genre.items %}
        <h2>{{ genre }}</h2>
        <div class="movie-scroll-container">
          <div class="movie-row">
            {% for movie in movies %}
                <div class="movie-card">
                    <img src="{{ movie.poster_link }}" alt="{{ movie.movie_name }}" width="24" height="18" class="movie-poster">
                    <h4>{{ movie.movie_name }}</h4>
                    <p>Год: {{ movie.year }}</p>
                    <p class="long2">Режиссер: {{ movie.director }}</p>
                    <p>Рейтинг: {{ movie.rating }}</p>
                    <p class="long3">Жанр: {{ movie.genre }}</p>
                    <div class="rating-div" id="rating">
                        {% if user.is_authenticated %}
                            {% if movie.id in user_favorites %}
                                <a href="{% url 'remove_from_favorites' movie.id %}" class="btn" style="background: #f44336;">Удалить</a>
                            {% else %}
                                <a href="{% url 'add_to_favorites' movie.id %}" class="btn" style="background: #4caf50;">В избранное</a>
                            {% endif %}
                        {% else %}
                            <a class="btn"></a>
                        {% endif %}
                        <a href="{% url 'movie_detail' movie.id %}" class="btn" style="background: #0000ff;">Подробнее</a>
                    </div>
                </div>
                {% if forloop.counter|divisibleby:2 and not forloop.last %}
                    <div class="movie-row"></div>
                {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endfor %}
    </main>

    <footer>
        <p>&copy; 2025 Cinema. All Rights Reserved.</p>
    </footer>
</body>
</html>