<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ movie.movie_name }} - KinoMore</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/movie-details.css' %}"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    {% include "header.html" %}

    <main class="main-content">
        <section class="movie-detail-section">
            <div class="movie-detail-container">
                <div class="movie-poster-container">
                    {% if movie.poster_link %}
                        <img src="{{ movie.poster_link }}" alt="{{ movie.movie_name }}" class="movie-poster-large">
                    {% else %}
                        <div class="no-poster-large">
                            <svg width="64" height="64" viewBox="0 0 24 24">
                                <path fill="var(--text-secondary)" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7.5 13h2v2H11V9H9.5v2.5h-2V9H6v6h1.5zm6.5 2h.5v1.5h1.5V16h.5v-1.5H17v-1h-1.5V13h-.5v1.5h-1V13H13v3zm.5-5.5h3V9h-3v1.5z"/>
                            </svg>
                            <p>Постер отсутствует</p>
                        </div>
                    {% endif %}
                </div>

                <div class="movie-info-container">
                    <div class="movie-header">
                        <h1 class="movie-title">{{ movie.movie_name }}</h1>
                        <div class="movie-meta">
                            <span class="movie-year">{{ movie.year }}</span>
                            <span class="movie-country">{{ movie.country }}</span>
                            <span class="movie-rating">
                                <svg width="20" height="20" viewBox="0 0 24 24">
                                    <path fill="#ffc107" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>
                                {{ movie.rating|default:"Нет оценки" }}
                            </span>
                            <span class="movie-genre">{{ movie.genre }}</span>
                        </div>
                    </div>

                    <div class="movie-details">
                        <div class="detail-row">
                            <h3 class="detail-label">Режиссер</h3>
                            <p class="detail-value">{{ movie.director }}</p>
                        </div>

                        <div class="detail-row">
                            <h3 class="detail-label">Описание</h3>
                            <p class="detail-value overview">{{ movie.overview|default:"Описание отсутствует." }}</p>
                        </div>

                        {% if user.is_authenticated %}
                        <div class="user-actions">
                            <div class="rating-form">
                                <h3 class="detail-label">Ваша оценка</h3>
                                <form method="post" action="{% url 'rate_movie' movie.id %}">
                                    {% csrf_token %}
                                    <div class="star-rating">
                                        {% for i in "54321" %}
                                            <input type="radio" id="star{{ i }}" name="user_rating" value="{{ i }}" 
                                                {% if user_rating == i|add:"0" %}checked{% endif %}>
                                            <label for="star{{ i }}" title="{{ i }}★">{{ i }}★</label>
                                        {% endfor %}
                                    </div>
                                    <button type="submit" class="rating-submit">
                                        {% if user_rating %}Изменить оценку{% else %}Сохранить оценку{% endif %}
                                    </button>
                                </form>
                            </div>

                            <div class="favorite-action">
                                {% if is_favorite %}
                                    <a href="{% url 'remove_from_favorites' movie.id %}" class="favorite-btn remove-favorite">
                                        <svg width="20" height="20" viewBox="0 0 24 24">
                                            <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                        </svg>
                                        Удалить из избранного
                                    </a>
                                {% else %}
                                    <a href="{% url 'add_to_favorites' movie.id %}" class="favorite-btn add-favorite">
                                        <svg width="20" height="20" viewBox="0 0 24 24">
                                            <path fill="currentColor" d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
                                        </svg>
                                        Добавить в избранное
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
    </main>

    {% include "footer.html" %}
</body>
</html>