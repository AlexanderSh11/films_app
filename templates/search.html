<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Поиск фильмов - KinoMore</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/search.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/movie-card.css' %}"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    {% include "header.html" %}
    
    <main class="main-content">
        <section class="search-section">
            <div class="search-container">
                <h1 class="search-title">Найти фильмы</h1>
                <p class="search-subtitle">Откройте для себя новые киноленты</p>
                
                <div class="search-filters">
                    <form method="get" class="filter-form">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="sort" class="filter-label">Сортировка</label>
                                <select id="sort" name="sort" class="filter-select">
                                    <option value="названию" {% if selected_sort == "названию" %}selected{% endif %}>По названию</option>
                                    <option value="рейтингу (сначала лучшие)" {% if selected_sort == "рейтингу (сначала лучшие)" %}selected{% endif %}>По рейтингу (высокий → низкий)</option>
                                    <option value="рейтингу (сначала худшие)" {% if selected_sort == "рейтингу (сначала худшие)" %}selected{% endif %}>По рейтингу (низкий → высокий)</option>
                                    <option value="году выхода (сначала новые)" {% if selected_sort == "году выхода (сначала новые)" %}selected{% endif %}>По году (новые → старые)</option>
                                    <option value="году выхода (сначала старые)" {% if selected_sort == "году выхода (сначала старые)" %}selected{% endif %}>По году (старые → новые)</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="genre" class="filter-label">Жанр</label>
                                <select id="genre" name="genre" class="filter-select">
                                    <option value="Все" {% if selected_genre == "Все" %}selected{% endif %}>Все жанры</option>
                                    <option value="Аниме" {% if selected_genre == "Аниме" %}selected{% endif %}>Аниме</option>
                                    <option value="Боевик" {% if selected_genre == "Боевик" %}selected{% endif %}>Боевик</option>
                                    <option value="Приключение" {% if selected_genre == "Приключение" %}selected{% endif %}>Приключение</option>
                                    <option value="Анимация" {% if selected_genre == "Анимация" %}selected{% endif %}>Анимация</option>
                                    <option value="Биография" {% if selected_genre == "Биография" %}selected{% endif %}>Биография</option>
                                    <option value="Комедия" {% if selected_genre == "Комедия" %}selected{% endif %}>Комедия</option>
                                    <option value="Криминал" {% if selected_genre == "Криминал" %}selected{% endif %}>Криминал</option>
                                    <option value="Драма" {% if selected_genre == "Драма" %}selected{% endif %}>Драма</option>
                                    <option value="Детектив" {% if selected_genre == "Детектив" %}selected{% endif %}>Детектив</option>
                                    <option value="Семейный" {% if selected_genre == "Семейный" %}selected{% endif %}>Семейный</option>
                                    <option value="Фэнтези" {% if selected_genre == "Фэнтези" %}selected{% endif %}>Фэнтези</option>
                                    <option value="Фильм-нуар" {% if selected_genre == "Фильм-нуар" %}selected{% endif %}>Фильм-нуар</option>
                                    <option value="Хоррор" {% if selected_genre == "Хоррор" %}selected{% endif %}>Хоррор</option>
                                    <option value="История" {% if selected_genre == "История" %}selected{% endif %}>История</option>
                                    <option value="Музыка" {% if selected_genre == "Музыка" %}selected{% endif %}>Музыка</option>
                                    <option value="Мюзикл" {% if selected_genre == "Мюзикл" %}selected{% endif %}>Мюзикл</option>
                                    <option value="Мистика" {% if selected_genre == "Мистика" %}selected{% endif %}>Мистика</option>
                                    <option value="Мелодрама" {% if selected_genre == "Мелодрама" %}selected{% endif %}>Мелодрама</option>
                                    <option value="Фантастика" {% if selected_genre == "Фантастика" %}selected{% endif %}>Фантастика</option>
                                    <option value="Спорт" {% if selected_genre == "Спорт" %}selected{% endif %}>Спорт</option>
                                    <option value="Триллер" {% if selected_genre == "Триллер" %}selected{% endif %}>Триллер</option>
                                    <option value="Военный" {% if selected_genre == "Военный" %}selected{% endif %}>Военный</option>
                                    <option value="Вестерн" {% if selected_genre == "Вестерн" %}selected{% endif %}>Вестерн</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="filter-submit">
                                <svg width="18" height="18" viewBox="0 0 24 24" style="margin-right: 8px;">
                                    <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                </svg>
                                Применить фильтры
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="search-results-header">
                    <h3 class="results-title">Результаты поиска</h3>
                    <p class="results-meta">Сортировка: по <span class="highlight">{{ selected_sort }}</span> • Жанр: <span class="highlight">{{ selected_genre }}</span></p>
                    <p class="results-count">{{ movies|length }} фильмов найдено</p>
                </div>
                
                {% if movies %}
                <div class="search-results-grid">
                    {% for movie in movies %}
                    <div class="movie-card">
                        <div class="movie-poster-container">
                            <img src="{{ movie.poster_link }}" alt="{{ movie.movie_name }}" class="movie-poster">
                            <div class="movie-rating">{{ movie.rating }}</div>
                            {% if movie.id in user_favorites %}
                            <div class="favorite-badge">
                                <svg width="24" height="24" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                            </div>
                            {% endif %}
                        </div>
                        <div class="movie-info">
                            <h3 class="movie-title">{{ movie.movie_name }}</h3>
                            <p class="movie-meta">{{ movie.year }} • {{ movie.country }}</p>
                            <p class="movie-meta">{{ movie.genre }}</p>
                            <p class="movie-director">Режиссер: {{ movie.director }}</p>
                            <div class="movie-actions">
                                {% if user.is_authenticated %}
                                    {% if movie.id in user_favorites %}
                                        <a href="{% url 'remove_from_favorites' movie.id %}" class="action-btn remove-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24">
                                                <path fill="currentColor" d="M19 13H5v-2h14v2z"/>
                                            </svg>
                                            Удалить
                                        </a>
                                    {% else %}
                                        <a href="{% url 'add_to_favorites' movie.id %}" class="action-btn add-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24">
                                                <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                            </svg>
                                            В избранное
                                        </a>
                                    {% endif %}
                                {% endif %}
                                <a href="{% url 'movie_detail' movie.id %}" class="action-btn details-btn">Подробнее</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-results">
                    <svg width="64" height="64" viewBox="0 0 24 24">
                        <path fill="var(--accent-color)" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        <path fill="var(--accent-color)" d="M9.5 6C8.67 6 8 6.67 8 7.5S8.67 9 9.5 9 11 8.33 11 7.5 10.33 6 9.5 6zm0 6c-.83 0-1.5-.67-1.5-1.5S8.67 9 9.5 9s1.5.67 1.5 1.5S10.33 12 9.5 12z"/>
                    </svg>
                    <h3>Фильмы не найдены</h3>
                    <p>Попробуйте изменить параметры поиска</p>
                </div>
                {% endif %}
            </div>
        </section>
    </main>

    {% include "footer.html" %}
</body>
</html>